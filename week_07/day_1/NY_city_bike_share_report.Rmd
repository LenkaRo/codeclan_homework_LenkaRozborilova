---
title: "NY City Bike Share"
author: "Lenka Rozborilova"
date: "18/01/2021"
output: html_document
code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      results = "hide",
                      error = FALSE,
                      warning = FALSE,
                      message = FALSE)
```

```{r}
library(tsibbledata)
library(tsibble)
library(tidyverse)
library(lubridate)
library(slider)
```

The following report presents an insight into the New York City’s bike share system - one of the largest bike shares in the US. 
The descriptive analysis was carried out on an available data set of 10 bikes that were monitored during the year of 2018.

```{r}
#?nyc_bikes

head(nyc_bikes)

# we are presented with 10 time series, each following an individual bike throughout the 2018
unique(nyc_bikes$bike_id) 
```

```{r}
index_var(nyc_bikes)
key_vars(nyc_bikes)
```

```{r}
# create new columns: date, day, week day/weekend, month, year and duration (in sec and hrs)
nyc_bikes_updated <- nyc_bikes %>% 
  select(-start_lat, -start_long, -end_lat, -end_long) %>% 
  mutate(
    date = as_date(start_time),
    hour = hour(start_time),
    day = wday(start_time, week_start = 1, label = TRUE),
    weekday = ifelse(day %in% c("Sat", "Sun"), "weekend", "weekday"),
    month = month(start_time, label = TRUE),
    year = year(start_time),
    duration = as.duration(stop_time - start_time),
    duration_hrs = as.numeric(duration, "hours")
  ) 

nyc_bikes_updated 
```

```{r}
# visualization - bike hire throughout the year 2018, during the week, hire duration
```

Here’s a graph of an average usage of a NYC City's bike throughout the year of 2018

```{r}
# Here’s a graph of an average usage of 1 bike throughout the year of 2018
nyc_bikes_updated %>%
  index_by(date) %>% 
  summarise(total = n()/10) %>% 
  ggplot() + 
  geom_line(size = 1, aes(x = date, y = total))
```

Bike usage throughout a day, split by week days and weekend days

```{r}
# bike usage throughout a day, split by week days and weekend days
# The most popular bike hire times during the weekdays are 7-10AM and 5-8PM. These rush hours suggest people use the bikes to commute to work and than back home. Generarly, the middle of the day is less busy.
# While over the weekend days, the peak is spread over the day hours 10AM-6PM, presumably as people enjoy the bikes for leasure purpose and scenery rides.
nyc_bikes_updated %>% 
  ggplot() +
  aes(x = hour, fill = weekday) +
  geom_density(aes(y = ..density..), alpha = 0.5) +
  scale_x_continuous(breaks = c(0, 4, 8, 12, 16, 20)) +
  theme_classic() +
  theme(legend.title = element_blank()) +
  labs(
    x = "Time (hours)",
    y = "Popular hours",
    title = "NYC Citi Bike trips by hour of day"
  ) 
```

This graph represents the total duration of City Bike hire of the observed 10 bikes in 2018

```{r}
# This graph represents the total duration of City Bike hire of the observed 10 bikes in 2018
nyc_bikes_updated %>% 
  index_by(year) %>%
  group_by(gender) %>% 
  filter(gender != "Unknown") %>% 
  summarise(duration_total = sum(duration_hrs)) %>% 
  ggplot() +
  aes(x = gender, y = duration_total, fill = gender) +
  geom_col(alpha = 0.5) +
  theme_classic() +
  coord_flip() +
  labs(
    x = "",
    y = "Time (hours)",
    title = "Total duration of bike hire in 2018" 
  )
```

```{r}

# summaries of a typical customer, proportions
```


```{r}
# hire counts for all 10 bikes

## in a year
nyc_bikes_year <- nyc_bikes %>% 
  index_by(year = year(start_time)) %>% 
  summarise(hire_count = n())

## in each quarter 
nyc_bikes_quarters <- nyc_bikes %>% 
  index_by(quarter = quarter(start_time)) %>% 
  summarise(hire_count = n())

## in each month
nyc_bikes_months <- nyc_bikes %>% 
  index_by(month = month(start_time, label = TRUE)) %>% 
  summarise(hire_count = n())

## in each day
nyc_bikes_days <- nyc_bikes %>% 
  index_by(day = wday(start_time, week_start = 1, label = TRUE)) %>% 
  summarise(hire_count = n())
```


```{r}
# visualization

# the busiest month of the year 2018 was August 
nyc_bikes_months %>% 
  ggplot(aes(x = month, y = hire_count)) +
  geom_point() + 
  geom_line(group = 1) +
  labs(
    title = "Bike hire count throughout the 2018"
  )
```




```{r}
# hire counts for each of the 10 bikes

## in a year
nyc_bikes %>% 
  group_by(bike_id) %>% 
  index_by(year = year(start_time)) %>% 
  summarise(hire_count = n())

## in each quarter 
nyc_bikes %>% 
  group_by(bike_id) %>% 
  index_by(quarter = quarter(start_time)) %>% 
  summarise(hire_count = n())

## in each month
nyc_bikes %>% 
  group_by(bike_id) %>% 
  index_by(month = month(start_time, label = TRUE)) %>% 
  summarise(hire_count = n())

## in each day
nyc_bikes %>% 
  group_by(bike_id) %>% 
  index_by(day = wday(start_time, week_start = 1, label = TRUE)) %>% 
  summarise(hire_count = n())
```


